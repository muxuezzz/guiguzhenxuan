import{K as L,d as le,r as m,R as pe,e as s,o as g,y as C,w as t,h as e,i as n,j as h,f as D,x as M,F as j,D as H,g as Q,n as F,L as P,t as ce,_ as te,c as me,O as _e,N as fe,A as ge,S as Se,k as Z,C as ee}from"./index-167c0a10.js";const ve=(S,U,V)=>L.get(`/admin/product/${S}/${U}?category3Id=${V}`),ae=()=>L.get("/admin/product/baseTrademark/getTrademarkList"),ue=S=>L.get("/admin/product/spuImageList/"+S),oe=S=>L.get("/admin/product/spuSaleAttrList/"+S),ne=()=>L.get("/admin/product/baseSaleAttrList"),ye=S=>S.id?L.post("/admin/product/updateSpuInfo",S):L.post("/admin/product/saveSpuInfo",S),be=S=>L.post("/admin/product/saveSkuInfo",S),Ve=S=>L.get("/admin/product/findBySpuId/"+S),ke=S=>L.delete("/admin/product/deleteSpu/"+S),Ae=["src"],Ie=le({__name:"spuForm",emits:["changeScene"],setup(S,{expose:U,emit:V}){let k=m([]),y=m([]),A=m([]),w=m([]),r=m(!1),q=m(""),_=m({category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),b=m("");const N=async l=>{_.value=l;let a=await ae(),o=await ue(l.id),I=await oe(l.id),E=await ne();k.value=a.data,y.value=o.data.map(K=>({name:K.imgName,url:K.imgUrl})),A.value=I.data,w.value=E.data},z=l=>{q.value=l.url,r.value=!0},d=()=>{console.log("要删除图片了")},p=l=>l.type=="image/png"||l.type=="image/jpeg"||l.type=="image/gif"?l.size/1024/1024<3?!0:(P({type:"error",message:"上传文件务必小于3M"}),!1):(P({type:"error",message:"上传文件务必PNG|JPG|GIF"}),!1);let i=pe(()=>w.value.filter(a=>A.value.every(o=>a.name!=o.saleAttrName)));const x=()=>{const[l,a]=b.value.split(":");let o={baseSaleAttrId:l,saleAttrName:a,spuSaleAttrValueList:[]};A.value.push(o),b.value=""},$=l=>{l.flag=!0,l.saleAttrValue=""},B=l=>{const{baseSaleAttrId:a,saleAttrValue:o}=l;let I={baseSaleAttrId:a,saleAttrValueName:o};if(o.trim()==""){P({type:"error",message:"属性值不能为空的"});return}if(l.spuSaleAttrValueList.find(K=>K.saleAttrValueName==o)){P({type:"error",message:"属性值重复"});return}l.spuSaleAttrValueList.push(I),l.flag=!1},f=async()=>{_.value.spuImageList=y.value.map(a=>({imgName:a.name,imgUrl:a.response&&a.response.data||a.url})),_.value.spuSaleAttrList=A.value,(await ye(_.value)).code==200?(P({type:"success",message:_.value.id?"更新成功":"添加成功"}),V("changeScene",{flag:0,params:_.value.id?"update":"add"})):P({type:"success",message:_.value.id?"更新成功":"添加成功"})},c=()=>{V("changeScene",{flag:0})};return U({initHasSpuData:N,initAddSpu:async l=>{y.value=[],A.value=[],b.value="",Object.assign(_.value,{category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),_.value.category3Id=l;let a=await ae(),o=await ne();k.value=a.data,w.value=o.data}}),(l,a)=>{const o=s("el-input"),I=s("el-form-item"),E=s("el-option"),K=s("el-select"),X=s("Plus"),v=s("el-icon"),Y=s("el-upload"),T=s("el-dialog"),G=s("el-button"),W=s("el-table-column"),se=s("el-tag"),re=s("el-table"),de=s("el-form");return g(),C(de,{"label-width":"100px"},{default:t(()=>[e(I,{label:"SPU名称"},{default:t(()=>[e(o,{placeholder:"请你输入SPU名称",modelValue:n(_).spuName,"onUpdate:modelValue":a[0]||(a[0]=u=>n(_).spuName=u)},null,8,["modelValue"])]),_:1}),e(I,{label:"SPU品牌"},{default:t(()=>[e(K,{modelValue:n(_).tmId,"onUpdate:modelValue":a[1]||(a[1]=u=>n(_).tmId=u)},{default:t(()=>[h(' <el-option label="华为"></el-option> '),(g(!0),D(j,null,M(n(k),(u,J)=>(g(),C(E,{key:u.id,label:u.tmName,value:u.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(I,{label:"SPU描述"},{default:t(()=>[e(o,{type:"textarea",placeholder:"请你输入SPU描述",modelValue:n(_).description,"onUpdate:modelValue":a[2]||(a[2]=u=>n(_).description=u)},null,8,["modelValue"])]),_:1}),e(I,{label:"SPU图片"},{default:t(()=>[h(` v-model:fileList->展示默认图片 \r
                 action:上传图片的接口地址\r
                 list-type:文件列表的类型\r
            `),e(Y,{"file-list":n(y),"onUpdate:fileList":a[3]||(a[3]=u=>H(y)?y.value=u:y=u),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":z,"on-remove":d,"before-upload":p},{default:t(()=>[e(v,null,{default:t(()=>[e(X)]),_:1})]),_:1},8,["file-list"]),e(T,{modelValue:n(r),"onUpdate:modelValue":a[4]||(a[4]=u=>H(r)?r.value=u:r=u)},{default:t(()=>[Q("img",{"w-full":"",src:n(q),alt:"Preview Image",style:{width:"100%",height:"100%"}},null,8,Ae)]),_:1},8,["modelValue"])]),_:1}),e(I,{label:"SPU销售属性"},{default:t(()=>[h(" 展示销售属性的下拉菜单 "),e(K,{modelValue:n(b),"onUpdate:modelValue":a[5]||(a[5]=u=>H(b)?b.value=u:b=u),placeholder:n(i).length?`还未选择${n(i).length}个`:"无"},{default:t(()=>[(g(!0),D(j,null,M(n(i),(u,J)=>(g(),C(E,{value:`${u.id}:${u.name}`,key:u.id,label:u.name},null,8,["value","label"]))),128)),h(" :value使用字符串形式绑定，确保在下一步任务重更加方便 ")]),_:1},8,["modelValue","placeholder"]),e(G,{onClick:x,disabled:!n(b),style:{"margin-left":"10px"},type:"primary",size:"default",icon:"Plus"},{default:t(()=>[F(" 添加属性 ")]),_:1},8,["disabled"]),h(" table展示销售属性与属性值的地方 "),e(re,{border:"",style:{margin:"10px 0px"},data:n(A)},{default:t(()=>[e(W,{label:"序号",type:"index",align:"center",width:"80px"}),e(W,{label:"销售属性名字",width:"120px",prop:"saleAttrName"}),e(W,{label:"销售属性值"},{default:t(({row:u,$index:J})=>[(g(!0),D(j,null,M(u.spuSaleAttrValueList,(R,ie)=>(g(),C(se,{style:{margin:"0px 5px"},onClose:Pe=>u.spuSaleAttrValueList.splice(ie,1),key:u.id,class:"mx-1",closable:""},{default:t(()=>[F(ce(R.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),u.flag==!0?(g(),C(o,{key:0,onBlur:R=>B(u),modelValue:u.saleAttrValue,"onUpdate:modelValue":R=>u.saleAttrValue=R,placeholder:"请你输入属性值",size:"small",style:{width:"100px"}},null,8,["onBlur","modelValue","onUpdate:modelValue"])):(g(),C(G,{key:1,onClick:R=>$(u),type:" primary",size:"small",icon:"Plus"},null,8,["onClick"]))]),_:1}),e(W,{label:"操作",width:"120px"},{default:t(({row:u,$index:J})=>[e(G,{type:"primary",size:"small",icon:"Delete",onClick:R=>n(A).splice(J,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(I,null,{default:t(()=>[e(G,{type:"primary",size:"default",onClick:f},{default:t(()=>[F("保存")]),_:1}),e(G,{type:"primary",size:"default",onClick:c},{default:t(()=>[F("取消")]),_:1})]),_:1})]),_:1})}}}),Ue=te(Ie,[["__file","C:/MyFile/Work/VUE/vue3_admin_template/project/src/views/product/spu/spuForm.vue"]]),xe=["src"],he=le({__name:"skuForm",emits:["changeScene"],setup(S,{expose:U,emit:V}){let k=m([]),y=m([]),A=m([]),w=m(),r=me({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""});const q=async(z,d,p)=>{r.category3Id=p.category3Id,r.spuId=p.id,r.tmId=p.tmId;let i=await _e(z,d,p.category3Id),x=await oe(p.id),$=await ue(p.id);k.value=i.data,y.value=x.data,A.value=$.data},_=z=>{A.value.forEach(d=>{w.value.toggleRowSelection(d,!1)}),w.value.toggleRowSelection(z,!0)},b=()=>{V("changeScene",{flag:0})},N=async()=>{console.log("save"),r.skuAttrValueList=k.value.reduce((d,p)=>{if(p.attrIdAndValueId){let[i,x]=p.attrIdAndValueId.split(":");d.push({attrId:i,valueId:x})}return d},[]),r.skuSaleAttrValueList=y.value.reduce((d,p)=>{if(p.saleIdAndValueId){let[i,x]=p.saleIdAndValueId.split(":");d.push({saleAttrId:i,saleAttrValueId:x})}return d},[]),(await be(r)).code==200?(P({type:"success",message:"添加SKU成功"}),V("changeScene",{flag:0,params:""})):P({type:"error",message:"添加SKU失败"})};return U({initSkuData:q}),(z,d)=>{const p=s("el-input"),i=s("el-form-item"),x=s("el-option"),$=s("el-select"),B=s("el-form"),f=s("el-table-column"),c=s("el-button"),O=s("el-table");return g(),C(B,{"label-width":"100px"},{default:t(()=>[e(i,{label:"SKU名称"},{default:t(()=>[e(p,{placeholder:"SKU名称",modelValue:n(r).skuName,"onUpdate:modelValue":d[0]||(d[0]=l=>n(r).skuName=l)},null,8,["modelValue"])]),_:1}),e(i,{label:"价格(元)"},{default:t(()=>[e(p,{placeholder:"价格(元)",type:"number",modelValue:n(r).price,"onUpdate:modelValue":d[1]||(d[1]=l=>n(r).price=l)},null,8,["modelValue"])]),_:1}),e(i,{label:"重量(g)"},{default:t(()=>[e(p,{placeholder:"重量(g)",type:"number",modelValue:n(r).weight,"onUpdate:modelValue":d[2]||(d[2]=l=>n(r).weight=l)},null,8,["modelValue"])]),_:1}),e(i,{label:"SKU描述"},{default:t(()=>[e(p,{placeholder:"SKU描述",type:"textarea",modelValue:n(r).skuDesc,"onUpdate:modelValue":d[3]||(d[3]=l=>n(r).skuDesc=l)},null,8,["modelValue"])]),_:1}),e(i,{label:"平台属性"},{default:t(()=>[h(" 一行显示多个 "),e(B,{inline:!0},{default:t(()=>[(g(!0),D(j,null,M(n(k),(l,a)=>(g(),C(i,{key:l.id,label:l.attrName},{default:t(()=>[e($,{modelValue:l.attrIdAndValueId,"onUpdate:modelValue":o=>l.attrIdAndValueId=o},{default:t(()=>[(g(!0),D(j,null,M(l.attrValueList,(o,I)=>(g(),C(x,{value:`${l.id}:${o.id}`,key:o.id,label:o.valueName},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(i,{label:"销售属性"},{default:t(()=>[e(B,{inline:!0},{default:t(()=>[(g(!0),D(j,null,M(n(y),(l,a)=>(g(),C(i,{label:l.saleAttrName,key:l.id},{default:t(()=>[e($,{modelValue:l.saleIdAndValueId,"onUpdate:modelValue":o=>l.saleIdAndValueId=o},{default:t(()=>[(g(!0),D(j,null,M(l.spuSaleAttrValueList,(o,I)=>(g(),C(x,{value:`${l.id}:${o.id}`,key:o.id,label:o.saleAttrValueName},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(i,{label:"图片名称"},{default:t(()=>[e(O,{border:"",data:n(A),ref_key:"table",ref:w},{default:t(()=>[e(f,{type:"selection",width:"80px",align:"center"}),e(f,{label:"图片"},{default:t(({row:l,$index:a})=>[Q("img",{src:l.imgUrl,alt:"",style:{width:"100px",height:"100px"}},null,8,xe)]),_:1}),e(f,{label:"名称",prop:"imgName"}),e(f,{label:"操作"},{default:t(({row:l,$index:a})=>[e(c,{type:"primary",size:"small",onClick:o=>_(l)},{default:t(()=>[F(" 设置默认 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(i,null,{default:t(()=>[e(c,{type:"primary",size:"default",onClick:N},{default:t(()=>[F("保存")]),_:1}),e(c,{type:"primary",size:"default",onClick:b},{default:t(()=>[F("取消")]),_:1})]),_:1})]),_:1})}}}),Ce=te(he,[["__file","C:/MyFile/Work/VUE/vue3_admin_template/project/src/views/product/spu/skuForm.vue"]]),we=["src"],Ne=le({__name:"index",setup(S){let U=fe(),V=m(2),k=m(1),y=m(3),A=m([]),w=m(0),r=m(),q=m(),_=m([]),b=m(!1);ge(()=>U.c3Id,()=>{A.value=[],U.c3Id&&N()});const N=async(f=1)=>{k.value=f;let c=await ve(k.value,y.value,U.c3Id);c.code==200&&(A.value=c.data.records,w.value=c.data.total)},z=()=>{N()},d=()=>{V.value=1,r.value.initAddSpu(U.c3Id)},p=f=>{V.value=2,q.value.initSkuData(U.c1Id,U.c2Id,f)},i=async f=>{let c=await Ve(f.id);console.log(c),c.code==200&&(_.value=c.data,b.value=!0)},x=async f=>{(await ke(f.id)).code==200?(P({message:"删除成功",type:"success"}),N()):P({message:"删除失败",type:"error"})},$=f=>{V.value=f.flag,f.params=="update"?N(k.value):N()},B=f=>{V.value=1,console.log("updateSpu"),r.value.initHasSpuData(f)};return Se(()=>{U.$reset}),(f,c)=>{const O=s("Category"),l=s("el-button"),a=s("el-table-column"),o=s("el-popconfirm"),I=s("el-table"),E=s("el-pagination"),K=s("el-dialog"),X=s("el-card");return g(),D("div",null,[e(O),e(X,{style:{margin:"10px 0px"}},{default:t(()=>[h(" v-if|v-show:都可以实现显示与隐藏 "),Z(Q("div",null,[e(l,{onClick:d,type:"primary",size:"default",icon:"Plus",disabled:!n(U).c3Id},{default:t(()=>[F(" 添加SPU ")]),_:1},8,["disabled"]),h(" 展示已有SPU数据 "),e(I,{style:{margin:"10px 0px"},border:"",data:n(A)},{default:t(()=>[e(a,{label:"序号",type:"index",align:"center",width:"80px"}),e(a,{label:"SPU名称",prop:"spuName"}),e(a,{label:"SPU描述",prop:"description","show-overflow-tooltip":""}),e(a,{label:"SPU操作"},{default:t(({row:v,$index:Y})=>[e(l,{type:"primary",size:"small",icon:"Plus",title:"添加SKU",onClick:T=>p(v)},null,8,["onClick"]),e(l,{type:"primary",size:"small",icon:"Edit",title:"修改SPU",onClick:T=>B(v)},null,8,["onClick"]),e(l,{type:"primary",size:"small",icon:"View",title:"查看SKU列表",onClick:T=>i(v)},null,8,["onClick"]),e(o,{title:`你确定删除${v.spuName}?`,width:"200px",onConfirm:T=>x(v)},{reference:t(()=>[e(l,{type:"primary",size:"small",icon:"Delete",title:"删除SPU"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),h(" 分页器 "),e(E,{"current-page":n(k),"onUpdate:currentPage":c[0]||(c[0]=v=>H(k)?k.value=v:k=v),"page-size":n(y),"onUpdate:pageSize":c[1]||(c[1]=v=>H(y)?y.value=v:y=v),"page-sizes":[3,5,7,9],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:n(w),onCurrentChange:N,onSizeChange:z},null,8,["current-page","page-size","total"])],512),[[ee,n(V)==0]]),h(" 添加SPU|修改SPU子组件 "),Z(e(Ue,{ref_key:"spu",ref:r,onChangeScene:$},null,512),[[ee,n(V)==1]]),h(" 添加SKU的子组件 "),Z(e(Ce,{ref_key:"sku",ref:q,onChangeScene:$},null,512),[[ee,n(V)==2]]),h(" dialog对话框:展示已有的SKU数据 "),e(K,{modelValue:n(b),"onUpdate:modelValue":c[2]||(c[2]=v=>H(b)?b.value=v:b=v),title:"SKU列表"},{default:t(()=>[e(I,{border:"",data:n(_)},{default:t(()=>[e(a,{label:"SKU名字",prop:"skuName"}),e(a,{label:"SKU价格",prop:"price"}),e(a,{label:"SKU重量",prop:"weight"}),e(a,{label:"SKU图片"},{default:t(({row:v,$index:Y})=>[Q("img",{src:v.skuDefaultImg,style:{width:"100px",height:"100px"}},null,8,we)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})])}}}),ze=te(Ne,[["__file","C:/MyFile/Work/VUE/vue3_admin_template/project/src/views/product/spu/index.vue"]]);export{ze as default};
