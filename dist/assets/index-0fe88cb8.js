import{K as h,d as pe,r as u,c as me,H as ce,e as p,o as R,f as M,h as l,w as t,F as $,i as s,D as V,n as i,j as q,g as I,t as B,y as H,x as fe,B as _e,L as x,p as ve,q as ge,_ as ye}from"./index-167c0a10.js";import{u as be}from"./setting-8941f21d.js";const we=(r,U,d)=>h.get(`/admin/acl/user/${r}/${U}/?username=${d}`),Ve=r=>r.id?h.put("/admin/acl/user/update",r):h.post("/admin/acl/user/save",r),he=r=>h.get("/admin/acl/user/toAssign/"+r),Ce=r=>h.post("/admin/acl/user/doAssignRole",r),ke=r=>h.delete("/admin/acl/user/remove/"+r),xe=r=>h.delete("/admin/acl/user/batchRemove",{data:r}),Ue=r=>(ve("data-v-22d7ff98"),r=r(),ge(),r),ze={style:{}},Se=Ue(()=>I("h4",null,"分配角色",-1)),Re={style:{}},qe=pe({__name:"index",setup(r){let U=be(),d=u(1),C=u(5),L=u(0),z=u([]),c=u(!1),f=u(!1),k=u([]),g=u([]),n=me({username:"",name:"",password:""}),A=u([]),y=u(""),S=u();ce(()=>{b()});const b=async(o=1)=>{d.value=o;const e=await we(d.value,C.value,y.value);e.code==200&&(L.value=e.data.total,z.value=e.data.records)},K=()=>{b()},W=()=>{c.value=!0,Object.assign(n,{id:0,username:"",name:"",password:""})},G=o=>{c.value=!0,Object.assign(n,o),_e(()=>{S.value.clearValidate("username"),S.value.clearValidate("name")})},J=async()=>{await S.value.validate(),(await Ve(n)).code==200?(c.value=!1,x({type:"success",message:n.id?"更新成功":"添加成功"}),window.location.reload()):(c.value=!1,x({type:"error",message:n.id?"更新失败":"添加失败"}))},Q=()=>{c.value=!1},X={username:[{required:!0,trigger:"blur",validator:(o,e)=>{o.trim().length>=5?e():e(new Error("用户名字至少五位"))}}],name:[{required:!0,trigger:"blur",validator:(o,e)=>{o.trim().length>=5?e():e(new Error("用户昵称至少五位"))}}],password:[{required:!0,trigger:"blur",validator:(o,e)=>{o.trim().length>=6?e():e(new Error("用户密码至少六位"))}}]},Y=async o=>{Object.assign(n,o);let e=await he(n.id);e.code==200&&(k.value=e.data.allRolesList,g.value=e.data.assignRoles,f.value=!0)},E=u(!1),N=u(!0),Z=o=>{g.value=o?k.value:[],N.value=!1},ee=o=>{E.value=o.length===k.value.length,N.value=o.length!==k.value.length},le=async()=>{let o={userId:n.id,roleIdList:g.value.map(_=>_.id)};(await Ce(o)).code==200&&(x({type:"success",message:"分配职务成功"}),f.value=!1,b(d.value))},ae=async o=>{(await ke(o)).code==200&&(x({type:"success",message:"删除成功"}),b(z.value.length>1?d.value:d.value-1))},te=o=>{A.value=o},oe=async()=>{let o=A.value.map(_=>_.id);(await xe(o)).code==200&&(x({type:"success",message:"删除成功"}),b(z.value.length>1?d.value:d.value-1))},se=()=>{b(),y.value=""},ne=()=>{U.refsh=!U.refsh};return(o,e)=>{const _=p("el-input"),w=p("el-form-item"),m=p("el-button"),j=p("el-form"),D=p("el-card"),v=p("el-table-column"),re=p("el-popconfirm"),de=p("el-table"),ue=p("el-pagination"),O=p("el-drawer"),P=p("el-checkbox"),ie=p("el-checkbox-group");return R(),M($,null,[l(D,{style:{height:"80px"}},{default:t(()=>[l(j,{inline:!0,class:"form"},{default:t(()=>[l(w,{label:"用户名:"},{default:t(()=>[l(_,{placeholder:"请你输入搜索用户名",modelValue:s(y),"onUpdate:modelValue":e[0]||(e[0]=a=>V(y)?y.value=a:y=a)},null,8,["modelValue"])]),_:1}),l(w,null,{default:t(()=>[l(m,{type:"primary",size:"default",disabled:!s(y),onClick:se},{default:t(()=>[i(" 搜索 ")]),_:1},8,["disabled"]),l(m,{type:"primary",size:"default",onClick:ne},{default:t(()=>[i("重置")]),_:1})]),_:1})]),_:1})]),_:1}),l(D,{style:{margin:"10px 0px"}},{default:t(()=>[l(m,{type:"primary",size:"default",onClick:W},{default:t(()=>[i(" 添加用户 ")]),_:1}),l(m,{type:"primary",size:"default",disabled:s(A).length,onClick:oe},{default:t(()=>[i(" 批量删除 ")]),_:1},8,["disabled"]),l(de,{onSelectionChange:te,style:{margin:"10px 0px"},border:"",data:s(z)},{default:t(()=>[l(v,{type:"selection",align:"center"}),l(v,{label:"#",align:"center",type:"index"}),l(v,{label:"ID",align:"center",prop:"id"}),l(v,{label:"用户名字",align:"center",prop:"username","show-overflow-tooltip":""}),l(v,{label:"用户名称",align:"center",prop:"name","show-overflow-tooltip":""}),l(v,{label:"用户角色",align:"center",prop:"roleName","show-overflow-tooltip":""}),l(v,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),l(v,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),l(v,{align:"center",label:"操作",width:"300px"},{default:t(({row:a,$index:T})=>[l(m,{type:"primary",size:"small",icon:"User",onClick:F=>Y(a)},{default:t(()=>[i(" 分配角色 ")]),_:2},1032,["onClick"]),l(m,{type:"primary",size:"small",icon:"Edit",onClick:F=>G(a)},{default:t(()=>[i(" 编辑 ")]),_:2},1032,["onClick"]),l(re,{title:`你确定要删除${a.username}?`,width:"260px",onConfirm:F=>ae(a.id)},{reference:t(()=>[l(m,{type:"primary",size:"small",icon:"Delete"},{default:t(()=>[i(" 删除 ")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),q(" 分页器 "),l(ue,{"current-page":s(d),"onUpdate:currentPage":e[1]||(e[1]=a=>V(d)?d.value=a:d=a),"page-size":s(C),"onUpdate:pageSize":e[2]||(e[2]=a=>V(C)?C.value=a:C=a),"page-sizes":[5,7,9,11],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:s(L),onCurrentChange:b,onSizeChange:K},null,8,["current-page","page-size","total"]),q(" 抽屉结构:完成添加新的用户账号|更新已有的账号信息 "),l(O,{modelValue:s(c),"onUpdate:modelValue":e[6]||(e[6]=a=>V(c)?c.value=a:c=a)},{header:t(()=>[I("h4",null,B(s(n).id?"更新用户":"添加用户"),1)]),default:t(()=>[l(j,{model:s(n),ref_key:"formRef",ref:S,rules:X},{default:t(()=>[l(w,{label:"用户姓名",prop:"username"},{default:t(()=>[l(_,{placeholder:"请您输入用户姓名",modelValue:s(n).username,"onUpdate:modelValue":e[3]||(e[3]=a=>s(n).username=a)},null,8,["modelValue"])]),_:1}),l(w,{label:"用户昵称",prop:"name"},{default:t(()=>[l(_,{placeholder:"请您输入用户昵称",modelValue:s(n).name,"onUpdate:modelValue":e[4]||(e[4]=a=>s(n).name=a)},null,8,["modelValue"])]),_:1}),s(n).id?q("v-if",!0):(R(),H(w,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[l(_,{placeholder:"请您输入用户密码",modelValue:s(n).password,"onUpdate:modelValue":e[5]||(e[5]=a=>s(n).password=a)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"]),I("div",ze,[l(m,{onClick:Q},{default:t(()=>[i("取消")]),_:1}),l(m,{type:"primary",onClick:J},{default:t(()=>[i("确定")]),_:1})])]),_:1},8,["modelValue"]),l(O,{modelValue:s(f),"onUpdate:modelValue":e[11]||(e[11]=a=>V(f)?f.value=a:f=a)},{header:t(()=>[Se]),default:t(()=>[l(j,null,{default:t(()=>[l(w,{label:"用户姓名"},{default:t(()=>[l(_,{modelValue:s(n).username,"onUpdate:modelValue":e[7]||(e[7]=a=>s(n).username=a),disabled:!0},null,8,["modelValue"])]),_:1}),l(w,{label:"职位列表"},{default:t(()=>[l(P,{onChange:Z,modelValue:E.value,"onUpdate:modelValue":e[8]||(e[8]=a=>E.value=a),indeterminate:N.value},{default:t(()=>[i(" 全选 ")]),_:1},8,["modelValue","indeterminate"]),q(" 显示职位的的复选框 "),l(ie,{modelValue:s(g),"onUpdate:modelValue":e[9]||(e[9]=a=>V(g)?g.value=a:g=a),onChange:ee},{default:t(()=>[(R(!0),M($,null,fe(s(k),(a,T)=>(R(),H(P,{key:T,label:a},{default:t(()=>[i(B(a.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),I("div",Re,[l(m,{onClick:e[10]||(e[10]=a=>V(f)?f.value=!1:f=!1)},{default:t(()=>[i("取消")]),_:1}),l(m,{type:"primary",onClick:le},{default:t(()=>[i("确定")]),_:1})])]),_:1},8,["modelValue"])]),_:1})],64)}}});const Le=ye(qe,[["__scopeId","data-v-22d7ff98"],["__file","C:/MyFile/Work/VUE/vue3_admin_template/project/src/views/acl/user/index.vue"]]);export{Le as default};
