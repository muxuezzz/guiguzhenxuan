import{K as C,d as le,r as p,c as te,H as ae,e as i,o as oe,f as ne,h as l,w as t,j as R,i as r,D as g,F as re,n as f,g as P,B as E,L as S,p as se,q as ie,_ as de}from"./index-167c0a10.js";import{u as ue}from"./setting-8941f21d.js";const ce=(o,y,d)=>C.get(`/admin/acl/role/${o}/${y}/?roleName=${d}`),pe=o=>o.id?C.put("/admin/acl/role/update",o):C.post("/admin/acl/role/save",o),me=o=>C.get("/admin/acl/permission/toAssign/"+o),fe=(o,y)=>C.post(`/admin/acl/permission/doAssign/?roleId=${o}&permissionId=${y}`),_e=o=>C.delete("/admin/acl/role/remove/"+o),ve=o=>(se("data-v-126dcbbc"),o=o(),ie(),o),ge=ve(()=>P("h4",null,"分配菜单与按钮的权限",-1)),ye={style:{flex:"auto"}},be=le({__name:"index",setup(o){let y=ue(),d=p(1),h=p(10),v=p(""),V=p([]),I=p(0),m=p(!1),x=p(),_=p(!1),s=te({roleName:""}),U=p([]),N=p([]),z=p();ae(()=>{b()});const b=async(n=1)=>{d.value=n;let e=await ce(d.value,h.value,v.value);e.code==200&&(I.value=e.data.total,V.value=e.data.records)},L=()=>{b()},M=()=>{b(),v.value=""},O=()=>{y.refsh=!y.refsh},T=()=>{m.value=!0,Object.assign(s,{roleName:"",id:0}),E(()=>{x.value.clearValidate("roleName")})},B=n=>{m.value=!0,Object.assign(s,n),E(()=>{x.value.clearValidate("roleName")})},D={roleName:[{required:!0,trigger:"blur",validator:(n,e)=>{n.trim().length>=2?e():e(new Error("职位名称至少两位"))}}]},F=async()=>{await x.value.validate(),(await pe(s)).code==200&&(S({type:"success",message:s.id?"更新成功":"添加成功"}),m.value=!1,b(s.id?d.value:1))},H=async n=>{Object.assign(s,n);let e=await me(s.id);e.code==200&&(N.value=e.data,U.value=q(N.value,[])),_.value=!0},K={children:"children",label:"name"},q=(n,e)=>(n.forEach(u=>{u.select&&u.level==4&&e.push(u.id),u.children&&u.children.length>0&&q(u.children,e)}),e),W=async()=>{const n=s.id;let e=z.value.getCheckedKeys(),u=z.value.getHalfCheckedKeys(),w=e.concat(u);(await fe(n,w)).code==200&&(_.value=!1,S({type:"success",message:"分配权限成功"}),window.location.reload())},G=async n=>{(await _e(n)).code==200&&(S({type:"success",message:"删除成功"}),b(V.value.length>1?d.value:d.value-1))};return(n,e)=>{const u=i("el-input"),w=i("el-form-item"),c=i("el-button"),$=i("el-form"),j=i("el-card"),k=i("el-table-column"),J=i("el-popconfirm"),Q=i("el-table"),X=i("el-pagination"),Y=i("el-dialog"),Z=i("el-tree"),ee=i("el-drawer");return oe(),ne(re,null,[l(j,null,{default:t(()=>[l($,{inline:!0,class:"form"},{default:t(()=>[l(w,{label:"职位搜索"},{default:t(()=>[l(u,{placeholder:"请你输入搜索职位关键字",modelValue:r(v),"onUpdate:modelValue":e[0]||(e[0]=a=>g(v)?v.value=a:v=a)},null,8,["modelValue"])]),_:1}),l(w,null,{default:t(()=>[l(c,{type:"primary",size:"default",disabled:!r(v),onClick:M},{default:t(()=>[f(" 搜索 ")]),_:1},8,["disabled"]),l(c,{type:"primary",size:"default",onClick:O},{default:t(()=>[f("重置")]),_:1})]),_:1})]),_:1})]),_:1}),l(j,{style:{margin:"10px 0px"}},{default:t(()=>[l(c,{type:"primary",size:"default",icon:"Plus",onClick:T},{default:t(()=>[f(" 添加职位 ")]),_:1}),l(Q,{border:"",style:{margin:"10px 0px"},data:r(V)},{default:t(()=>[l(k,{type:"index",align:"center",label:"#"}),l(k,{label:"ID",align:"center",prop:"id"}),l(k,{label:"职位名称",align:"center",prop:"roleName","show-overflow-tooltip":""}),l(k,{label:"创建世间",align:"center","show-overflow-tooltip":"",prop:"createTime"}),l(k,{label:"更新时间",align:"center","show-overflow-tooltip":"",prop:"updateTime"}),l(k,{label:"操作",width:"280px",align:"center"},{default:t(({row:a,$index:Ce})=>[l(c,{type:"primary",size:"small",icon:"User",onClick:A=>H(a)},{default:t(()=>[f(" 分配权限 ")]),_:2},1032,["onClick"]),l(c,{type:"primary",size:"small",icon:"Edit",onClick:A=>B(a)},{default:t(()=>[f(" 编辑 ")]),_:2},1032,["onClick"]),l(J,{title:`你确定要删除${a.roleName}?`,width:"260px",onConfirm:A=>G(a.id)},{reference:t(()=>[l(c,{type:"primary",size:"small",icon:"Delete"},{default:t(()=>[f(" 删除 ")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(X,{"current-page":r(d),"onUpdate:currentPage":e[1]||(e[1]=a=>g(d)?d.value=a:d=a),"page-size":r(h),"onUpdate:pageSize":e[2]||(e[2]=a=>g(h)?h.value=a:h=a),"page-sizes":[10,20,30,40],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:r(I),onCurrentChange:b,onSizeChange:L},null,8,["current-page","page-size","total"])]),_:1}),R(" 添加职位与更新已有职位的结构:对话框 "),l(Y,{modelValue:r(m),"onUpdate:modelValue":e[5]||(e[5]=a=>g(m)?m.value=a:m=a),title:r(s).id?"更新职位":"添加职位"},{footer:t(()=>[l(c,{type:"primary",size:"default",onClick:e[4]||(e[4]=a=>g(m)?m.value=!1:m=!1)},{default:t(()=>[f(" 取消 ")]),_:1}),l(c,{type:"primary",size:"default",onClick:F},{default:t(()=>[f("确定")]),_:1})]),default:t(()=>[l($,{model:r(s),rules:D,ref_key:"form",ref:x},{default:t(()=>[l(w,{label:"职位名称",prop:"roleName"},{default:t(()=>[l(u,{placeholder:"请你输入职位名称",modelValue:r(s).roleName,"onUpdate:modelValue":e[3]||(e[3]=a=>r(s).roleName=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),R(" 抽屉组件:分配职位的菜单权限与按钮的权限 "),l(ee,{modelValue:r(_),"onUpdate:modelValue":e[7]||(e[7]=a=>g(_)?_.value=a:_=a)},{header:t(()=>[ge]),default:t(()=>[R(" 树形控件 "),l(Z,{ref_key:"tree",ref:z,data:r(N),"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":r(U),props:K},null,8,["data","default-checked-keys"])]),footer:t(()=>[P("div",ye,[l(c,{onClick:e[6]||(e[6]=a=>g(_)?_.value=!1:_=!1)},{default:t(()=>[f("取消")]),_:1}),l(c,{type:"primary",onClick:W},{default:t(()=>[f("确定")]),_:1})])]),_:1},8,["modelValue"])],64)}}});const xe=de(be,[["__scopeId","data-v-126dcbbc"],["__file","C:/MyFile/Work/VUE/vue3_admin_template/project/src/views/acl/role/index.vue"]]);export{xe as default};
